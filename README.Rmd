---
output: github_document
bibliography: references.bib
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  out.width = "100%"
)
options(tibble.print_min = 5, tibble.print_max = 5)
```


# PMLSeg

PMLseg is a R package for the segmentation of univariate time series based on Penalized Maximum Likelihood. The method detects changes in the mean signal in the presence of a periodic bias and variance changing over prescribed intervals. A preliminary version was published under the name `GNSSseg` which was developed for the detection of change-points in daily GNSS minus reanalysis IWV time series with annual periodic bias and variance changing on monthly intervals. PMLseg is more versatile and can be used with time series provided in a data frame containing two columns (date and signal). The package includes the segmentation function as well as auxiliary functions for the validation with metadata, cluster screening, and visualization of the time series with segmentation results. The theoretical basis of the method can be found in [@Quarello2022]. 
 
## Table of Contents

- [Installation](#installation)
- [Functions](#functions)
- [Examples](#examples)

## Installation

The development version of `PMLSeg` can be installed from GitHub with:

```{r, eval=FALSE}

# Install devtools, tidyr, and purr if you haven't already
install.packages("devtools")
install.packages("tidyr")
install.packages("purr")

# Download and install gfpop from
https://cran.r-project.org/src/contrib/Archive/gfpop/gfpop_1.1.1.tar.gz
install.packages("gfpop_1.1.1.tar.gz")

# Install PMLseg from GitHub
devtools::install_github("khanhninhnguyen/PMLSeg")
```

# Functions

The package contains the following functions:

```{r, eval=FALSE}
Segmentation(
  OneSeries,            # data frame, n x 2, $signal, $date in Date format
  lmin = 1,             # minimum length of the segments
  Kmax = 30,            # maximal number of segments
  selectionK = "BM_BJ", # penalty criterion used for the model selection
  FunctPart = TRUE,     # include the functional part in the model 
  selectionF = FALSE,   # select only significant coefficients in the functional
  initf="ascendent"     # initialization in the iterative inference procedure.
)

Validation(
  OneSeries,            # data frame, n x 2, $signal, $date in Date format
  Tmu,                  # segmentation results
  MaxDist = 62,         # maximum distance (in days) between detected CP in Tmu and known events in Metadata
  Metadata              # data frame with two columns: $date and the $type
)

Cluster_screening(
  Tmu,                  # segmentation results
  MaxDist = 80,         # maximal number of days between change-points within a cluster
  alpha = 0.05,         # significance level of test
  detail = FALSE        # if TRUE the output contains a $detail field with additional information on the test
)

UpdatedParametersForFixedCP(
  OneSeries,            # data frame, n x 2, $signal, $date in Date format
  ResScreening,         # output from Cluster_screening function
  FunctPart = TRUE,     # update functional part
  selectionF = FALSE,   # select only significant coefficients in the functional
)

PlotSeg(
  OneSeries,            # data frame, n x 2, $signal, $date in Date format
  SegRes,               # output from Segmentation function
  FunctPart = TRUE,     # plot functional
  RemoveData = NULL,    # remove screened data
  Metadata = NULL,      # plot metadata
  Validated_CP_Meta = NULL, # plot validation result
  labelx = "Date",
  labely = "signal"
)
```

Usage and help on functions can be found by ?"function" in R console, e.g.

```{r, eval=FALSE}
?Segmentation
```

## Examples

Preview the examples given in the `Examples.md/` folder.

## References







